# 2026-02-10 Daily Notes

## 00:07 例行記憶整理（cron）
- 已讀取並整理：`2026-02-09.md`、`2026-02-10.md`
- 已完成：
  - 將 2/9 重複段落去重
  - 合併為統一結構（ComfyUI / Moltbook / 記憶規則 / OpenClaw / M365）
  - 保留可執行的下一步清單
- 未執行：`MEMORY.md` 更新（依規則禁止自動更新）

## 今日新增事件
- 目前無新的使用者事件輸入（僅完成跨日整理初始化）

## 06:07 例行記憶整理（cron）
- 檢查範圍：`2026-02-09.md`、`2026-02-10.md`
- 結果：無新增可去重或重構內容（前次 00:07 整理後結構維持一致）
- 規則遵循：未更新 `MEMORY.md`

## 07:2x-08:0x 模型穩定性與更新處理
- 使用者反映 Google antigravity（特別是 `claude-opus-4-5-thinking`）不穩，對話中多次出現：
  - `Claude Opus 4.5 is no longer available. Please switch to Claude Opus 4.6.`
- 驗證結果：`claude-sonnet-4-5-thinking` 可切換且可用；Opus 4.5 仍間歇性不可用。
- 已依使用者要求執行 Gateway 重置流程：
  - 先透過 config patch 開啟 `commands.restart=true`
  - Gateway 實際已成功重啟並恢復正常運作。
- 使用者新偏好（已同步至 `MEMORY.md` 並 commit）：
  - 之後有更新消息要主動告知，且先提供「升級好處/壞處」評估再讓使用者決定。
- 依使用者同意執行升級：
  - `openclaw update --yes` 因非 git 安裝 + 套件管理偵測問題而跳過。
  - 改用 `npm i -g openclaw@latest` 成功安裝 `2026.2.9`。
- 升級後重要狀態：
  - `~/.npm-global/bin/openclaw` 為 `2026.2.9`
  - `/usr/bin/openclaw` 仍是 `2026.2.6-3`
  - 目前存在 PATH/執行檔來源不一致（新舊並存）需後續整理。
- 使用者偏好：傾向由主代理自行判斷並分派給子代理處理（除非使用者特別要求不開/指定）。
- M365 取件 Flow（Forms→Power Automate→SharePoint）穩定化研究結論：
  - 建議架構：Get items（OData 粗篩 + Top Count）→ Filter array（精篩/字串末三碼/大小寫/空值防護）→ Condition 依 length=0/1/>1 分流 → Update item。
  - 關鍵 expression：`equals(length(body('Filter_array')),1)`、`first(body('Filter_array'))?['ID']`，以及以 `trim(coalesce(...,''))`、`toLower()`、`if(greaterOrEquals(length(...),3),substring(...),...)` 做防呆。
  - OData 雷點：顯示名 vs 內部欄位名、單引號跳脫、null vs ''、型別不一致、函式支援落差、清單 threshold/索引。
  - `Cannot edit in read-only editor` 排查：是否在 run history、權限/owner、managed solution、DLP、瀏覽器快取/UI，建議用 Compose/變數承接 expression。
  - 最短測試：驗證 Get items 筆數、Filter array 筆數、分支、Update item 目標 ID；測例含唯一/無命中/重複/空值/含單引號特殊字元。
- 使用者決策：M365 取件配對鍵以「病歷號碼 + 單位」為準（不依賴表單回覆順序或 SharePoint ID/序號）。
- Power Automate 新設計工具注意：Filter array（Query）動作的 `where` 必須是 template language expression（通常需 `@and(...)`），若被當成純字串（缺 `@` 或 UI 輸入方式不對）會在儲存時出現 400：`WorkflowRunActionInputsInvalidProperty` / `Property 'where' must be a template language expression.`；較穩作法是清空 fx 後改用「基本模式」用 UI 重建條件。
- Forms→Flow 取值關鍵：`取得回應詳細資料` 的 body 欄位 key 通常是 `r<hash>`（非中文題目名）。已確認取件表單回傳 key：MRN=`rf74a84e5e7804be8a222caa8f7374367`、取件人=`ra262c3a9c3654135a8cb8113c0fb6c0c`、單位=`r3df245b9050842b8a2a6dbd17ab48082`；Flow 必須改用這些 key 才不會寫入空白。
- 入庫/登記 Flow（Forms_病歷室入庫）目前 PostItem 只寫死單位"/"、數量1、Status=已登記，導致其他欄位空白；需依登記表單 `取得回應詳細資料.body` 的 r<hash> keys 重新 mapping 到 SharePoint 欄位。已先在 UI 把入庫 Flow 的 Create item 設定 SubmittedAt=`utcNow()`，並清空 ReceivedAt（入庫不應寫取件時間）。
